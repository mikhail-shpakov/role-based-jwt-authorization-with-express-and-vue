(function(e){function t(t){for(var a,n,i=t[0],c=t[1],l=t[2],u=0,d=[];u<i.length;u++)n=i[u],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&d.push(r[n][0]),r[n]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);f&&f(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],a=!0,n=1;n<s.length;n++){var i=s[n];0!==r[i]&&(a=!1)}a&&(o.splice(t--,1),e=c(c.s=s[0]))}return e}var a={},n={app:0},r={app:0},o=[];function i(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-1196ed98":"20f90583","chunk-2e27e203":"e08ea512","chunk-6c6ba650":"29c944bd"}[e]+".js"}function c(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,c),s.l=!0,s.exports}c.e=function(e){var t=[],s={"chunk-1196ed98":1,"chunk-2e27e203":1,"chunk-6c6ba650":1};n[e]?t.push(n[e]):0!==n[e]&&s[e]&&t.push(n[e]=new Promise((function(t,s){for(var a="css/"+({}[e]||e)+"."+{"chunk-1196ed98":"d1bf6d6c","chunk-2e27e203":"a7c8b5b8","chunk-6c6ba650":"dedd8f1b"}[e]+".css",r=c.p+a,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var l=o[i],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===a||u===r))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){l=d[i],u=l.getAttribute("data-href");if(u===a||u===r)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var a=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=a,delete n[e],f.parentNode.removeChild(f),s(o)},f.href=r;var h=document.getElementsByTagName("head")[0];h.appendChild(f)})).then((function(){n[e]=0})));var a=r[e];if(0!==a)if(a)t.push(a[2]);else{var o=new Promise((function(t,s){a=r[e]=[t,s]}));t.push(a[2]=o);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=i(e);var d=new Error;l=function(t){u.onerror=u.onload=null,clearTimeout(f);var s=r[e];if(0!==s){if(s){var a=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+a+": "+n+")",d.name="ChunkLoadError",d.type=a,d.request=n,s[1](d)}r[e]=void 0}};var f=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=a,c.d=function(e,t,s){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)c.d(s,a,function(t){return e[t]}.bind(null,a));return s},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var f=u;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0b68":function(e,t,s){},"0e68":function(e,t,s){"use strict";var a=s("c092"),n=s.n(a);n.a},1:function(e,t){},2:function(e,t){},"29b9":function(e,t,s){},3:function(e,t){},4:function(e,t){},4360:function(e,t,s){"use strict";var a=s("2b0e"),n=s("2f62"),r=s("0e44"),o=(s("e6cf"),s("6ef5")),i=s("a18c"),c=s("e140");const l=s("14b7"),u={userInfo:{},tokens:{accessToken:"",refreshToken:""},fingerprint:""},d={GET_USER:e=>e},f={UPDATE_TOKENS(e,t){e.tokens=t},SET_USER_DATA(e,t){e.tokens=t,e.userInfo=l.decode(t.accessToken)},REMOVE_USER_DATA(e){e.tokens={accessToken:"",refreshToken:""},e.userInfo={}},SET_FINGERPRINT(e,t){e.fingerprint=t}},h={LOGIN:async(e,t)=>{try{const s=await o["a"].baseHttpReq("auth/login","post",t);200===s.status&&(await e.commit("SET_USER_DATA",s.data),await i["a"].push({path:"/servers"})),401===s.status&&Object(c["a"])("Неверный логин или пароль")}catch(s){console.error(s)}},UPDATE_TOKENS:async e=>{try{const t=await o["a"].baseHttpReq("auth/refresh-tokens","post",{refreshToken:e.state.tokens.refreshToken,fingerprint:e.state.fingerprint});return 200===t.status?(await e.commit("UPDATE_TOKENS",t.data),!0):(401===t.status&&(await e.commit("REMOVE_USER_DATA"),await i["a"].push({path:"/login"}),Object(c["a"])("Сессия истекла, необходимо заново пройти авторизацию")),!1)}catch(t){return console.error(t),!1}},LOGOUT:async e=>{try{const t=await o["a"].extendHttpReq("auth/logout","post",{refreshToken:e.state.tokens.refreshToken});200===t.status&&(await _.commit("server/REMOVE_SERVER_LIST"),await e.commit("REMOVE_USER_DATA"),await i["a"].push({path:"/login"}))}catch(t){console.error(t)}},SET_FINGERPRINT:async(e,t)=>{await e.commit("SET_FINGERPRINT",t)}};var p={namespaced:!0,state:u,getters:d,actions:h,mutations:f};s("a434");const v={serverList:[]},m={SET_SERVER_LIST(e,t){e.serverList=t},EDIT_SERVER(e,t){const s=e.serverList.findIndex(e=>e.id===t.id);a["a"].set(e.serverList,s,t)},ADD_SERVER(e,t){e.serverList.push(t)},DELETE_SERVER(e,t){const s=e.serverList.findIndex(e=>e.id===t);e.serverList.splice(s,1)},REMOVE_SERVER_LIST(e){e.serverList=[]}},b={GET_SERVER_LIST:async e=>{try{const t=await o["a"].extendHttpReq("server","get");200===t.status&&await e.commit("SET_SERVER_LIST",t.data)}catch(t){console.error(t)}},EDIT_SERVER:async(e,t)=>{try{const s=await o["a"].extendHttpReq("server","patch",t);204===s.status&&(await e.commit("EDIT_SERVER",t),Object(c["a"])("Изменения сохранены","is-success"))}catch(s){console.error(s)}},ADD_SERVER:async(e,t)=>{try{const s=await o["a"].extendHttpReq("server","post",t);200===s.status&&(t.id=s.data.id,await e.commit("ADD_SERVER",t),Object(c["a"])("Сервер добавлен","is-success"))}catch(s){console.error(s)}},DELETE_SERVER:async(e,t)=>{try{const s=await o["a"].extendHttpReq("server","delete",{data:{id:t}});204===s.status&&(await e.commit("DELETE_SERVER",t),Object(c["a"])("Сервер удалён","is-success"))}catch(s){console.error(s)}}};var g={namespaced:!0,state:v,actions:b,mutations:m};a["a"].use(n["a"]);const E=new n["a"].Store({plugins:[Object(r["a"])()],modules:{user:p,server:g}});var _=t["a"]=E},5188:function(e,t,s){"use strict";var a=s("0b68"),n=s.n(a);n.a},"54cd":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("f5df");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("top-bar"),s("router-view",{staticClass:"pages"})],1)},r=[],o=(s("e6cf"),s("5530")),i=s("2f62"),c=s("e813"),l=s.n(c),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"section is-vertical-center"},[a("b-navbar",{staticClass:"navbar-custom",attrs:{"fixed-top":""}},[a("template",{slot:"brand"},[a("b-navbar-item",{staticClass:"item-logo",attrs:{href:"https://shpakov.dev/",target:"_blank",rel:"noopener"}},[a("img",{attrs:{src:s("9b19"),alt:"img-logo"}})])],1),a("template",{slot:"start"},[a("b-button",{staticClass:"is-text",attrs:{tag:"router-link",to:e.accessToken?"Servers":"Login"}},[e._v(e._s(e.accessToken?"Сервера":"Войти"))])],1),a("template",{slot:"end"},[a("b-button",{staticClass:"is-text",attrs:{tag:"router-link",to:"About"}},[e._v("О приложении")]),a("b-button",{attrs:{tag:"a",href:"https://github.com/mikhail-shpakov/role-based-jwt-authorization-with-express-and-vue",target:"_blank",rel:"noopener","icon-left":"github"}},[e._v("Репозиторий")]),e.accessToken?a("b-button",{staticClass:"is-danger is-outlined",attrs:{tag:"a",loading:e.isLoading},on:{click:e.logout}},[e._v("Выйти")]):e._e()],1)],2)],1)},d=[],f={name:"TopBar",data(){return{isLoading:!1}},computed:Object(o["a"])({},Object(i["c"])("user",{accessToken:e=>e.tokens.accessToken})),methods:Object(o["a"])({},Object(i["b"])("user",["LOGOUT"]),{async logout(){this.isLoading=!0,await this.LOGOUT(),this.isLoading=!1}})},h=f,p=(s("9204"),s("2877")),v=Object(p["a"])(h,u,d,!1,null,"c8da8e82",null),m=v.exports,b=s("a9cf"),g={components:{TopBar:m,Servers:b["default"]},methods:Object(o["a"])({},Object(i["b"])("user",["SET_FINGERPRINT"]),{setFingerprint(){const e=()=>{l.a.get(async e=>{const s=e.map(e=>e.value),a=l.a.x64hash128(s.join(""),31);await t(a)})},t=async e=>{await this.SET_FINGERPRINT(e)};window.requestIdleCallback?requestIdleCallback(async()=>{await e()}):setTimeout(async()=>{await e()},500)}}),mounted(){this.setFingerprint()}},E=g,_=(s("cf25"),Object(p["a"])(E,n,r,!1,null,null,null)),T=_.exports,S=(s("c519"),s("289d")),y=s("9483");Object(y["a"])("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});s("5363"),s("96cf");var k=s("a18c"),R=s("4360");a["a"].use(S["a"],{defaultIconPack:"mdi"}),a["a"].config.productionTip=!1,new a["a"]({router:k["a"],store:R["a"],render:e=>e(T)}).$mount("#app")},6172:function(e,t,s){"use strict";var a=s("8a5d"),n=s.n(a);n.a},"6ef5":function(e,t,s){"use strict";s("e6cf");var a=s("bc3a"),n=s.n(a);const r="https://role-based-auth-express-vue.herokuapp.com";var o=()=>n.a.create({baseURL:r}),i=s("4360"),c=s("e140");const l=i["a"].getters["user/GET_USER"],u=["auth/login","auth/refresh-tokens"],d=e=>{u.includes(e)||(n.a.defaults.headers.common.Authorization=`Bearer ${l.tokens.accessToken}`)},f=async e=>{if(!u.includes(e)){const e=l.userInfo.exp,t=Math.floor(Date.now().valueOf()/1e3);return!(e<t)||i["a"].dispatch("user/UPDATE_TOKENS")}return!0},h=async(e,t,s=null)=>o()[t](e,s).then(e=>e).catch(e=>(e.response&&401===e.response.status||Object(c["a"])("При запросе на сервер произошла ошибка, попробуйте повторить позднее"),e.response||e)),p=async(e,t="get",s=null)=>{const a=await f(e);if(a)return d(e),h(e,t,s)};t["a"]={baseHttpReq:h,extendHttpReq:p}},"7e9e":function(e,t,s){"use strict";var a=s("bfbf"),n=s.n(a);n.a},"8a5d":function(e,t,s){},9204:function(e,t,s){"use strict";var a=s("29b9"),n=s.n(a);n.a},"9b19":function(e,t,s){e.exports=s.p+"img/logo.2c1ecc8d.svg"},a18c:function(e,t,s){"use strict";s("e6cf");var a=s("2b0e"),n=s("8c4f"),r=s("4360"),o=(e,t,s)=>{const a=["/","/login","/about","/404"],n=a.includes(e.path.toLowerCase()),o=r["a"].getters["user/GET_USER"];return n||o.tokens.accessToken?s():s("/login")};a["a"].use(n["a"]);const i=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:()=>s.e("chunk-1196ed98").then(s.bind(null,"31e4"))},{path:"/about",name:"About",component:()=>s.e("chunk-6c6ba650").then(s.bind(null,"d530"))},{path:"/servers",name:"Servers",component:()=>Promise.resolve().then(s.bind(null,"a9cf"))},{path:"/404",name:"404",component:()=>s.e("chunk-2e27e203").then(s.bind(null,"588b"))},{path:"*",redirect:"/404"}],c=new n["a"]({mode:"history",base:"/",routes:i});c.beforeEach((e,t,s)=>{o(e,t,s)});t["a"]=c},a9cf:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-half"},[s("server-list",{on:{selectServer:e.selectServer}})],1),s("div",{staticClass:"column form"},[s("transition",{attrs:{name:"fade",mode:"out-in",duration:{enter:150,leave:150}}},["id"in e.selected?s("server-form",{attrs:{selected:e.selected}}):s("div",[s("div",{staticClass:"img",class:{choice:"admin"===e.role,"not-allowed":"user"===e.role}}),s("p",{staticClass:"has-text-centered"},[e._v(e._s(e.imgSubtitle))])])],1)],1)])},n=[],r=s("5530"),o=(s("6ef5"),s("2f62")),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("p",{staticClass:"title is-size-4"},[e._v("Список серверов")]),s("p",{staticClass:"subtitle"},[e._v(e._s(e.subtitleText))]),"admin"===e.role?s("a",{on:{click:function(t){return e.addServer()}}},[e._v("Добавить сервер")]):e._e(),s("div",{staticClass:"table-box"},[s("b-table",{attrs:{data:e.serverList,columns:e.columns,loading:e.isLoading,selected:e.selected,hoverable:"",striped:""},on:{"update:selected":function(t){e.selected=t}}},[s("template",{slot:"footer"},[s("div",{staticClass:"has-text-right"},[e._v("Серверов всего: "+e._s(e.serverList.length))])]),s("template",{slot:"empty"},[s("section",{staticClass:"section"},[s("div",{staticClass:"content has-text-grey has-text-centered"},[s("p",[s("b-icon",{attrs:{icon:"emoticon-sad",size:"is-large"}})],1),s("p",[e._v("Список серверов пуст")])])])])],2)],1)])},c=[],l=(s("e6cf"),{name:"serverList",data(){return{isLoading:!0,selected:{},columns:[{field:"id",label:"ID",width:"60"},{field:"serverName",label:"Название сервера"},{field:"serverType",label:"Тип сервера"}]}},computed:Object(r["a"])({},Object(o["c"])("server",{serverList:e=>e.serverList}),{},Object(o["c"])("user",{role:e=>Object.keys(e.userInfo).length?e.userInfo.permissions[0]:"user"}),{subtitleText(){return"admin"===this.role?"Нажмите на любой сервер, чтобы начать редактирование и Esc, чтобы выйти из режима редактирования":"Пользователь может только просматривать список серверов"}}),methods:Object(r["a"])({},Object(o["b"])("server",["GET_SERVER_LIST"]),{async fetchServerList(){await this.GET_SERVER_LIST(),this.isLoading=!1},addListenerEsc(){document.addEventListener("keyup",e=>{"Escape"===e.code&&(this.selected={})})},addServer(){const e={id:0,serverName:"",serverType:"dedicated"};this.$emit("selectServer",e)}}),watch:{selected(){"admin"===this.role&&this.$emit("selectServer",this.selected)},serverList:{handler(){this.selected={}},deep:!0}},async mounted(){await this.fetchServerList(),this.addListenerEsc()}}),u=l,d=(s("7e9e"),s("5188"),s("2877")),f=Object(d["a"])(u,i,c,!1,null,"4908a581",null),h=f.exports,p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{staticClass:"title is-size-4"},[e._v(e._s(e.selected.id?"Редактировать":"Новый сервер"))]),s("form",{staticClass:"box",on:{submit:function(t){return t.preventDefault(),e.saveChanges(t)}}},[e.selected.id?[s("p",[s("strong",[e._v("ID:")]),e._v(" "+e._s(e.selected.id))]),s("div",{staticClass:"divider"})]:e._e(),s("b-field",{attrs:{label:"Название сервера"}},[s("b-input",{attrs:{expanded:"",required:""},model:{value:e.local.serverName,callback:function(t){e.$set(e.local,"serverName","string"===typeof t?t.trim():t)},expression:"local.serverName"}})],1),s("b-field",{staticClass:"input-margin",attrs:{label:"Тип сервера"}},[s("b-select",{attrs:{expanded:""},model:{value:e.local.serverType,callback:function(t){e.$set(e.local,"serverType","string"===typeof t?t.trim():t)},expression:"local.serverType"}},e._l(["dedicated","vds","hosting"],(function(t){return s("option",{key:t,domProps:{value:t}},[e._v(e._s(t))])})),0)],1),s("div",{staticClass:"buttons is-pulled-right button-custom"},[e.selected.id?s("b-button",{attrs:{type:"is-danger","icon-left":"delete",loading:e.isLoadingDelete},on:{click:function(t){return e.confirmDelete()}}},[e._v("Удалить")]):e._e(),s("b-button",{attrs:{type:"is-success",loading:e.isLoadingChanges,disabled:e.isCheckStatusButton},on:{click:function(t){return e.saveChanges(e.selected.id?"edit":"add")}}},[e._v(e._s(e.selected.id?"Сохранить изменения":"Добавить сервер"))])],1)],2)])},v=[],m=(s("cca6"),{name:"serverForm",props:{selected:{type:Object,required:!0}},data(){return{isLoadingChanges:!1,isLoadingDelete:!1,local:{id:"",serverName:"",serverType:""}}},methods:Object(r["a"])({},Object(o["b"])("server",["EDIT_SERVER","ADD_SERVER","DELETE_SERVER"]),{async saveChanges(e){this.isCheckStatusButton||(this.isLoadingChanges=!0,"edit"===e?await this.EDIT_SERVER(this.local):await this.ADD_SERVER({serverName:this.local.serverName,serverType:this.local.serverType}),this.isLoadingChanges=!1)},confirmDelete(){this.$buefy.dialog.confirm({message:`Удалить сервер с названием <strong>${this.local.serverName}</strong>?`,cancelText:"Отмена",confirmText:"Удалить",type:"is-danger",onConfirm:async()=>{await this.deleteServer()}})},async deleteServer(){this.isLoadingDelete=!0,await this.DELETE_SERVER(this.local.id),this.isLoadingDelete=!1}}),computed:{isCheckStatusButton(){if(this.local.serverName.length<3)return!0;const e=Object.keys(this.local).some(e=>this.local[e]!==this.selected[e]);return!e}},watch:{selected:{handler(){this.local=Object.assign({},this.selected)},immediate:!0}}}),b=m,g=(s("c19c"),s("6172"),Object(d["a"])(b,p,v,!1,null,"7483c616",null)),E=g.exports,_={name:"Servers",components:{ServerList:h,ServerForm:E},data(){return{selected:{}}},computed:Object(r["a"])({},Object(o["c"])("user",{role:e=>Object.keys(e.userInfo).length?e.userInfo.permissions[0]:"user"}),{imgSubtitle(){return"admin"===this.role?"Сервер для редактирования не выбран":"Добавлять, удалять и редактировать сервера может только администратор"}}),methods:{selectServer(e){this.selected=e}}},T=_,S=(s("0e68"),Object(d["a"])(T,a,n,!1,null,"5b48d46e",null));t["default"]=S.exports},bfbf:function(e,t,s){},c092:function(e,t,s){},c19c:function(e,t,s){"use strict";var a=s("54cd"),n=s.n(a);n.a},c519:function(e,t,s){},cf25:function(e,t,s){"use strict";var a=s("fea6"),n=s.n(a);n.a},e140:function(e,t,s){"use strict";var a=s("aced");t["a"]=function(e,t="is-danger"){a["a"].open({message:e,position:"is-bottom",type:t,duration:3e3})}},fea6:function(e,t,s){}});
//# sourceMappingURL=app.33f83231.js.map